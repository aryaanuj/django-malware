{% extends 'core/layout/layout.html' %}
{%load static%}
{% block title %} HOME | UPLOAD {% endblock title %}
{% block content %}
<!-- ======= Analysis Section ======= -->
<section id="analysis" class="about">
	{% for message in messages %}
	<div id="alert" class="alert alert-{{message.tags}} mx-0 alert-dismissible fade show" role="alert">
		{{ message }}
	</div>
	{%endfor%}
	<div class="container-fluid pt-1">
		<div class="row">
			<div class="col-md-5 content">
				<div class="wrapper" data-aos="fade-up" data-aos-delay="150">
					<nav class="nav nav-tabs tabs" id="myTab" role="tablist">
						<div class="selector"></div>
						<a class="nav-link active active1"  id="file-url-tab" data-toggle="tab" href="#file-url" role="tab" aria-controls="home" aria-selected="true"><i class="fa fa-upload"></i> File/URL</a>
						<a class="nav-link" id="report-tab" data-toggle="tab" href="#report" role="tab" aria-controls="report" aria-selected="false"><i class="fa fa-search"></i> Report Search</a>
					</nav>
				</div>
				<div class="tab-content w-100" id="myTabContent">
					<!--=============== file url section ===============-->
					<div class="col-md-12 tab-pane fade show active" id="file-url" role="tabpanel" aria-labelledby="file-url-tab">
						<div class="intro-wrapper" id="file-url1">
							<p class="text-muted text-justify text-center"><!-- This is a free malware analysis service for the community that detects and analyzes unknown threats using a unique Malware Analysis technology. --></p>
							<div class="text-center dragandrophandler">
								<img src='{% static "core/image/scan.gif" %}' class="img-fluid">
								<p>DRAG & DROP FILES HERE</p>
							</div>
							<br><br>
							<div id="status1"></div>
							
							<div class="login-or">
								<hr class="hr-or">
								<span class="span-or">or</span>
								<button class="btn btn-block choosebtn">Choose File</button>
								<form method="post" enctype="multipart/form-data" id="analyze-form">
									{%csrf_token%}
									<input type="file" class="form-control" id="choosefile" required>
								</form>
							</div>
							<div class="row text-center text-dark" id="server">
								<!-- availble servers -->
								<!-- {% for server in apidata %}
									<div class="pl-4">
											<p>{{server.server_name}}</p>
											{% if server.status %}
												<i class="fa fa-server fa-2x" style="color:#25d366;"></i>
											{% else %}
												<i class="fa fa-server fa-2x" style="color:red;"></i>
											{% endif %}
											</div>
											{% endfor %} -->
										</div>
									</div>
								</div>
								<!-- ################# Report Search section ####################-->
								<div class="tab-pane fade" id="report" role="tabpanel" aria-labelledby="report-tab">
									<div class="intro-wrapper" id="file-url1">
										<p class="text-muted p-4 text-justify text-center"></p>
										<div class="col-md-10 intro-inner-wrapper wrap-in">
											<div class="text-center pb-5">
												<img src='{% static "core/image/search.gif" %}' class="img-fluid">
											</div>
											<div class="col-md-12">
												<form class="urlgs" method="GET">
													{% csrf_token %}
													<div class="input-group mb-3 w-100">
														<!-- csrf -->
														<input type="text" name="report_hash" class="form-control p-2" placeholder="MD5, SHA-1, SHA-256" id="report_val" aria-label="Report Search" aria-describedby="report_link" required>
														<div class="input-group-append">
															<a href= "" class="btn choosebtn" id="report_link"><i class="fa fa-search fa-spin"></i> Search</a>
														</div>
													</div>
												</form>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="col-md-7" style="overflow-x:auto;color:white;">
							<div class="text-center py-2"><h5>MY SUBMISSIONS</h5></div>
							<table  id="example3" class="table table-hover shadow index-submission text-center">
								<thead>
									<tr>
										<th>File Token</th>
										<th>Filename</th>
										<th>Filetype</th>
										<th>Date</th>
										<th>Analysis Results</th>
									</tr>
								</thead>
								<tbody>
									{% if analyzed_data %}
									{% for data in analyzed_data %}
									<tr>
										<td>{{data.uuid}}</td>
										<td>{{data.filename|truncatechars:15}}</td>
										<td>{{data.filetype}}</td>
										<td>{{data.created_at|date:"m-d-Y H:i:s"}}</td>
										<td><a href="{%url 'report' data.uuid %}" class="text-warning text-center" style="font-size:12px;color:#FFDE2E">VIEW RESULT</a></td>
									</tr>
									{% endfor %}
									<tr>
										<td colspan="5" class="text-center"><a href="{% url 'mysubmission' %}" class="btn btn-sm btn-block text-white"><i class="fa fa-arrow-down"></i> Load More</a></td>
									</tr>
									{% else %}
									<tr>
										<td colspan="6" class="text-center">No Records Found</td>
									</tr>
									{% endif %}
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</section><!-- End Analysis Section -->
			<section class="container-fluid">
				<div class="text-center" style="color:white">
					<div class="pt-2 text-center h3">TOP 10 SUBMISSIONS</div>
					<p class="text-center" style="font-size:16px;color:#FFE55C">Let us detects and analyzes unknown threats using a unique Malware Analysis technology.</p>
				</div>
				<div class="py-3">
					<table  id="example3" class="table table-hover shadow top-submission">
						<thead>
							<tr>
								<th>File Token</th>
								<th>Filename</th>
								<th>Filetype</th>
								<th>Date</th>
								<th>#</th>
							</tr>
						</thead>
						<tbody>
							{% if topsubmissions %}
							{%for submission in topsubmissions %}
							<tr>
								<td>{{submission.uuid}}</td>
								<td>{{submission.filename|truncatechars:30}}</td>
								<td>{{submission.filetype}}</td>
								<td>{{submission.created_at|date:"m-d-Y H:i:s"}}</td>
								<td><a href="{%url 'report' submission.uuid %}" class="text-warning text-center" style="font-size:12px;color:#FFDE2E">VIEW RESULT</a></td>
							</tr>
							{%endfor%}
							{% else %}
							<tr>
								<td colspan="6" class="text-center">No Records Found</td>
							</tr>
							{% endif %}
						</tbody>
					</table>
				</div>
			</section>
			<!-- intro section -->
			<br><br><br>
			<!-- file upload modal -->
			<div class="modal fade" id="file-upload-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" style="color:black!important" aria-hidden="true">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="exampleModalLongTitle">Getting Things Ready</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">
							<div class="text-center">
								<i id="imagetype" class="fa fa-image fa-5x"></i><br>
								<center class="py-2 my-2">
									<span class="file-name"></span>
									( <span class="file-size"></span> )
								</center>
							</div>
							<div class="my-2 py-2">
								<div id="prog" class="text-center text-success">
									<!-- message text here -->
								</div>
							</div>
						</div>
						<div class="modal-footer">
							<div class="align-center" id="analyzebtn">
								<button class="btn text-white" style="background-color:#200080;" data-toggle="modal" data-target="#file-analysis-modal" onclick="$('#file-upload-modal').hide(); $('#file-analysis-modal').show();" disabled>Process... <i class="fa fa-spinner fa-spin"></i></button>
							</div>
							<div id="datas"></div>
							<form action="report_search.php" method="post" id="d">
								<!-- <input type="hidden" name="csrf_token" value="<?= csrf_token(); ?>"> -->
							</form>
						</div>
					</div>
				</div>
			</div>
			{% endblock content %}
{% block script %}
{% include 'home/script.html' %}
<script>
	$("#alert").fadeTo(3000, 500).slideUp(500, function(){
    $("#alert").slideUp(500);
});
</script>
{% endblock %}