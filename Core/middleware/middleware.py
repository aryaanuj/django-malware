from django.shortcuts import redirect
import requests

def auth_middleware(get_response):
	
    def middleware(request):  
        current_url = request.META['PATH_INFO']
        if not request.user.is_authenticated:
        	if current_url != '/login' and current_url != '/register':
        		return redirect('login')
        else:
            if current_url == '/login' or current_url == '/register':

                return redirect('/')

        response = get_response(request)

        return response

    return middleware
